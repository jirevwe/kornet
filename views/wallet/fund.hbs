<div class="container">
	<form class="form-signin">
		<script src="https://js.paystack.co/v1/inline.js"></script>
		<h2 class="form-signin-heading">Fund Wallet</h2>
		<input type="text" id="amount" name="amount" placeholder="amount" class="form-control" required>
		<button type="button" class="btn btn-lg btn-primary btn-block" onclick="call()"> Pay </button>
	</form>
</div>
 
<script>
	let xhr = undefined;

	function call(){
		let am = $('#amount').val();
		payWithPaystack(am);
	}

	function payWithPaystack(amount){
		var handler = PaystackPop.setup({
			key: 'pk_test_12f7f084eaae304fcc2cd7993ba67143888232ee',
			email: '{{ user.email }}',
			firstname: '{{ user.first_name }}',
			lastname: '{{ user.last_name }}',
			phone: '{{ user.phone }}',
			amount: amount,
			reference: 'FUND YOUR WALLET',
			callback: function(response){
				//create a tramsaction
				let body = {
					details : response,
					operation: 2,
					transaction_type: 0
				};

				xhr = $.post('http://localhost:3000/wallet/create-transaction', body,(data, txtStat, jqXHR) => {});

				let fn = () =>
				{
					if(xhr != undefined && xhr.readyState != 4)
						xhr.abort();
				};
				setInterval(fn, 500);

				setTimeout(() => { window.location = '/wallet'; }, 2000);
			},
			onClose: function(){
				//show a message to the user
			}
		});
		handler.openIframe();
	}
</script>