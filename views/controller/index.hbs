  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <h1 class="page-header">Telco Portal</h1>

        {{> telco_nav }}
        {{# if hasErrors}}
            <div class="alert alert-danger">
                {{# each messages}}
                    <p>{{this}}</p>
                {{/each}}
            </div>
        {{/if}}
        <div id="success" class="alert alert-success {{#if noMessage }}hidden{{/if}}">
            {{successMsg}}
        </div>
      <h2 id="sub-header" class="sub-header">Businesses</h2>
      <div id="businesses_id" class="table-responsive">
        <table id="business_list" cellspacing="0" width="100%" class="table table-striped table-hover table-bordered">
          <thead>
            <tr>
              <th>Name</th>
              <th>Domain</th>
                <th>Staff</th>
              <th>Admin</th>
              <th>Created At</th>
              <th>Updated At</th>
            </tr>
          </thead>
          <tbody>
            {{# if businesses }}
              {{# each businesses }}
                  <tr onclick="view_numbers('{{this._id}}', '{{this.name}}', '{{this.default_pass}}', '{{this.domain}}', '{{this.staff_number}}')">
                      <td>{{ this.name }}</td>
                      <td>{{ this.domain }}</td>
                      <td>{{ this.staff_number }}</td>
                      <td>{{ this.admin.phone_number }}</td>
                      <td>{{formatDate this.created_at }}</td>
                      <td>{{formatDate this.modified_at }}</td>
                  </tr>
              {{/each}}
            {{/if}}
          </tbody>
        </table>
      </div>
        <div id="numbers_id" class="table-responsive" hidden>
            <table id="numbers_list" cellspacing="0" width="100%" class="table table-striped table-hover table-bordered">
                <thead>
                <tr>
                    <th>Number</th>
                    <th>Default Passwrod</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="numbers_list_body">

                </tbody>
            </table>
        </div>
    </div>
  </div>
<script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.2.4/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
<script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.2.4/js/buttons.html5.min.js"></script>
<script>
  $(document).ready(function(){
      datatableoptions = {
          "paging": true,
          "pageLength": 50,
          "lengthChange": true,
          "searching": true,
          "ordering": true,
          "info": true,
          "autoWidth": false,
          dom: 'Bfrtip',
          buttons: [
              'copy', 'csv', 'pdf'
          ]
      };
    $('#business_list').DataTable(datatableoptions);

  });

  function view_numbers(id, name, default_pass, domain, staff_number){
      $.ajax({
          method: "GET",
          url: "http://localhost:3000/controller/users/"+id,
          success: function(data){
              $('#businesses_id').hide();
              $('#numbers_id').show();
              $('#sub-header').html('Numbers');
              let users = data;
              for(i in users){
                  $('#numbers_list_body').append('<tr><td>'+users[i].phone_number+'</td><td>'+default_pass+'</td><td></td></tr>');
              }
              $('#numbers_list').DataTable(datatableoptions);
          },
          error: function(err){
              console.log(err);
          }
      });


  }
</script>