<div class="container">
    <a href="/mail/reply/{{message._id}}" class="btn btn-default">Reply</a>
    <a href="/mail/trash/{{message._id}}" class="btn btn-default">Move to Trash</a>
    <div class="list-group">
        <div href="/mail/{{message._id}}" class="list-group-item">
            <h4 class="list-group-item-heading">{{message.subject}}</h4>
            {{# if_eq messages.mailbox 'Inbox'}}
            <p class="list-group-item-text">From: {{message.from.text}}</p>
            {{else}}
            <p class="list-group-item-text">To: {{message.to.text}}</p>
            {{/if_eq}}
            <p class="list-group-item-text">Date: {{message.date}}</p>
            <br>
            <div id="text" class="container"></div>
                <div class="container">
                    <div id="attachments" class="list-group">
                    </div>
                </div>
]        </div>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
    let loaded, attachments = false;
    var socketio = io.connect();

    socketio.on("imap_end_message", function(data) {
        if(!loaded){
            console.log(data);
            $('#text').html(data['text']);
            loaded = true;
        }
    });

     socketio.on("imap_end_attachment", function(data) {
            console.log(data);
            $('#attachments').html('<a href="' + data['content']['link'] +'">' + data['content']['name'] + '</a>');
    });

    $(document).ready(function() {
        let get = $.ajax({
            url: "http://localhost:3000/mail/mail-body/{{message._id}}",
            type: "GET",
            async: true,
            success: function(response){
                console.log(response);
            },
            error: function(response){
                console.log("Error: " + JSON.stringify(response));
            }
        });
        console.log(get);
    });
</script>